{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\asus\\\\Desktop\\\\zucc-bysg\\\\web\\\\myapp\\\\src\\\\routes\\\\index.tsx\";\n\n/**\n * Created by 叶子 on 2017/8/13.\n */\nimport React from 'react';\nimport { Route, Redirect, Switch } from 'react-router-dom';\nimport { useAlita } from 'redux-alita';\nimport umbrella from 'umbrella-storage';\nimport AllComponents from '../components';\nimport routesConfig from './config';\nimport { checkLogin } from '../utils';\nimport RouteWrapper from './RouteWrapper';\n\nconst CRouter = props => {\n  const {\n    auth\n  } = props;\n  const [smenus] = useAlita({\n    smenus: null\n  }, {\n    light: true\n  });\n\n  const getPermits = () => {\n    return auth ? auth.permissions : null;\n  };\n\n  const requireAuth = (permit, component) => {\n    const permits = getPermits();\n    if (!permits || !permits.includes(permit)) return /*#__PURE__*/React.createElement(Redirect, {\n      to: '404',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 26,\n        columnNumber: 59\n      }\n    });\n    return component;\n  };\n\n  const requireLogin = (component, permit) => {\n    const permits = getPermits();\n\n    if (!checkLogin(permits)) {\n      // 线上环境判断是否登录\n      return /*#__PURE__*/React.createElement(Redirect, {\n        to: '/login',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 33,\n          columnNumber: 20\n        }\n      });\n    }\n\n    return permit ? requireAuth(permit, component) : component;\n  };\n\n  const createMenu = r => {\n    const route = r => {\n      const Component = r.component && AllComponents[r.component];\n      return /*#__PURE__*/React.createElement(Route, {\n        key: r.route || r.key,\n        exact: true,\n        path: r.route || r.key,\n        render: props => {\n          // 重新包装组件\n          const wrapper = /*#__PURE__*/React.createElement(RouteWrapper, Object.assign({ ...props,\n            Comp: Component,\n            route: r\n          }, {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 48,\n              columnNumber: 29\n            }\n          }));\n          return r.login ? wrapper : requireLogin(wrapper, r.requireAuth);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 41,\n          columnNumber: 17\n        }\n      });\n    };\n\n    const subRoute = r => r.subs && r.subs.map(subR => subR.subs ? subRoute(subR) : route(subR));\n\n    return r.component ? route(r) : subRoute(r);\n  };\n\n  const createRoute = key => routesConfig[key].map(createMenu);\n\n  const getAsyncMenus = () => smenus || umbrella.getLocalStorage('smenus') || [];\n\n  return /*#__PURE__*/React.createElement(Switch, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 9\n    }\n  }, Object.keys(routesConfig).map(key => createRoute(key)), getAsyncMenus().map(createMenu), /*#__PURE__*/React.createElement(Route, {\n    render: () => /*#__PURE__*/React.createElement(Redirect, {\n      to: \"/404\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 34\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 13\n    }\n  }));\n};\n\nexport default CRouter;","map":{"version":3,"sources":["C:/Users/asus/Desktop/zucc-bysg/web/myapp/src/routes/index.tsx"],"names":["React","Route","Redirect","Switch","useAlita","umbrella","AllComponents","routesConfig","checkLogin","RouteWrapper","CRouter","props","auth","smenus","light","getPermits","permissions","requireAuth","permit","component","permits","includes","requireLogin","createMenu","r","route","Component","key","wrapper","Comp","login","subRoute","subs","map","subR","createRoute","getAsyncMenus","getLocalStorage","Object","keys"],"mappings":"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","sourcesContent":["/**\n * Created by 叶子 on 2017/8/13.\n */\nimport React from 'react';\nimport { Route, Redirect, Switch } from 'react-router-dom';\nimport { useAlita } from 'redux-alita';\nimport umbrella from 'umbrella-storage';\nimport AllComponents from '../components';\nimport routesConfig, { IFMenuBase, IFMenu } from './config';\nimport { checkLogin } from '../utils';\nimport RouteWrapper from './RouteWrapper';\n\ntype CRouterProps = {\n    auth: any;\n};\n\nconst CRouter = (props: CRouterProps) => {\n    const { auth } = props;\n    const [smenus] = useAlita({ smenus: null }, { light: true });\n\n    const getPermits = (): any[] | null => {\n        return auth ? auth.permissions : null;\n    };\n    const requireAuth = (permit: any, component: React.ReactElement) => {\n        const permits = getPermits();\n        if (!permits || !permits.includes(permit)) return <Redirect to={'404'} />;\n        return component;\n    };\n    const requireLogin = (component: React.ReactElement, permit: any) => {\n        const permits = getPermits();\n        if (!checkLogin(permits)) {\n            // 线上环境判断是否登录\n            return <Redirect to={'/login'} />;\n        }\n        return permit ? requireAuth(permit, component) : component;\n    };\n    const createMenu = (r: IFMenu) => {\n        const route = (r: IFMenuBase) => {\n            const Component = r.component && AllComponents[r.component];\n            return (\n                <Route\n                    key={r.route || r.key}\n                    exact\n                    path={r.route || r.key}\n                    render={(props: any) => {\n                        // 重新包装组件\n                        const wrapper = (\n                            <RouteWrapper {...{ ...props, Comp: Component, route: r }} />\n                        );\n                        return r.login ? wrapper : requireLogin(wrapper, r.requireAuth);\n                    }}\n                />\n            );\n        };\n\n        const subRoute = (r: IFMenu): any =>\n            r.subs && r.subs.map((subR: IFMenu) => (subR.subs ? subRoute(subR) : route(subR)));\n\n        return r.component ? route(r) : subRoute(r);\n    };\n    const createRoute = (key: string) => routesConfig[key].map(createMenu);\n    const getAsyncMenus = () => smenus || umbrella.getLocalStorage('smenus') || [];\n    return (\n        <Switch>\n            {Object.keys(routesConfig).map((key) => createRoute(key))}\n            {getAsyncMenus().map(createMenu)}\n            <Route render={() => <Redirect to=\"/404\" />} />\n        </Switch>\n    );\n};\n\nexport default CRouter;\n"]},"metadata":{},"sourceType":"module"}